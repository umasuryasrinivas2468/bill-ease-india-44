# Aiva Invoice Detection - Visual Architecture

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE (React)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Aiva Chat Component                           â”‚  â”‚
â”‚  â”‚                     (Aiva.tsx)                                   â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ—¨ï¸ "What are my pending invoices?"                   â”‚     â”‚  â”‚
â”‚  â”‚  â”‚                                                        â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ“„ Based on your data, you have 5 pending          â”‚     â”‚  â”‚
â”‚  â”‚  â”‚     invoices totaling â‚¹45,000                       â”‚     â”‚  â”‚
â”‚  â”‚  â”‚                                                        â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ“„ View All Invoices              â†’         â”‚    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â”‚ (NEW: Clickable Action Link)                 â”‚    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â”‚  â”‚
â”‚  â”‚  â”‚                                          12:34 PM     â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                                  â”‚  â”‚
â”‚  â”‚  [Components]                                                   â”‚  â”‚
â”‚  â”‚  â€¢ useNavigate() - from React Router                           â”‚  â”‚
â”‚  â”‚  â€¢ handleActionClick() - navigate to path                      â”‚  â”‚
â”‚  â”‚  â€¢ getIconComponent() - render correct icon                    â”‚  â”‚
â”‚  â”‚  â€¢ Extended Message interface with actionLink                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–²
                                    â”‚ HTTP POST
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                     â”‚
                    Response                Request
               (with actionLink)        (question,
                                      dataContext)
                         â”‚                     â”‚
                         â”‚                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SUPABASE EDGE FUNCTION (Deno)                       â”‚
â”‚           financial-advisor/index.ts                                    â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  NEW: Invoice Detection Layer                                 â”‚    â”‚
â”‚  â”‚                                                               â”‚    â”‚
â”‚  â”‚  Input: "What are my pending invoices?"                      â”‚    â”‚
â”‚  â”‚         â†“                                                     â”‚    â”‚
â”‚  â”‚  detectInvoiceQuery(question)                                â”‚    â”‚
â”‚  â”‚  {                                                            â”‚    â”‚
â”‚  â”‚    isInvoiceRelated: true,                                   â”‚    â”‚
â”‚  â”‚    keywords: ['invoice', 'pending']                          â”‚    â”‚
â”‚  â”‚  }                                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Existing: Mistral AI Processing                              â”‚    â”‚
â”‚  â”‚                                                               â”‚    â”‚
â”‚  â”‚  model: "mistral-medium"                                      â”‚    â”‚
â”‚  â”‚  messages: [                                                  â”‚    â”‚
â”‚  â”‚    { role: 'system', content: systemPrompt },                â”‚    â”‚
â”‚  â”‚    { role: 'user', content: userMessage }                    â”‚    â”‚
â”‚  â”‚  ]                                                            â”‚    â”‚
â”‚  â”‚                                                               â”‚    â”‚
â”‚  â”‚  Response: "You have 5 pending invoices..."                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  NEW: Action Link Generation                                  â”‚    â”‚
â”‚  â”‚                                                               â”‚    â”‚
â”‚  â”‚  generateActionLink("invoice")                               â”‚    â”‚
â”‚  â”‚  â†“                                                            â”‚    â”‚
â”‚  â”‚  {                                                            â”‚    â”‚
â”‚  â”‚    label: "View All Invoices",                              â”‚    â”‚
â”‚  â”‚    path: "/invoices",                                        â”‚    â”‚
â”‚  â”‚    icon: "FileText"                                          â”‚    â”‚
â”‚  â”‚  }                                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                         â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Enhanced Response Structure                                  â”‚    â”‚
â”‚  â”‚                                                               â”‚    â”‚
â”‚  â”‚  {                                                            â”‚    â”‚
â”‚  â”‚    response: "You have 5 pending invoices...",              â”‚    â”‚
â”‚  â”‚    isInvoiceRelated: true,           â† NEW                  â”‚    â”‚
â”‚  â”‚    actionLink: {                      â† NEW                  â”‚    â”‚
â”‚  â”‚      label: "View All Invoices",                            â”‚    â”‚
â”‚  â”‚      path: "/invoices",                                     â”‚    â”‚
â”‚  â”‚      icon: "FileText"                                       â”‚    â”‚
â”‚  â”‚    }                                                          â”‚    â”‚
â”‚  â”‚  }                                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–²
                                    â”‚
                           HTTP Response
                          (includes actionLink)
                                    â”‚
                                    â–¼
                         [User sees action button]
                                    â”‚
                         [User clicks "View All Invoices"]
                                    â”‚
                                    â–¼
                         React Router navigates to /invoices
```

---

## Keyword Detection Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Question                  â”‚
â”‚  "Show me pending invoices"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ toLowerString()    â”‚
        â”‚ Check Each Keyword â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        â”‚        â”‚
        â–¼        â–¼        â–¼
    "show"  "me"  "pending"  "invoices"
        â”‚        â”‚        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚         â”‚        â”‚
      âœ—        âœ—         âœ“        âœ“
              (Not in list) (Matches) (Matches)
                           â”‚        â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                    â–¼
                    keywords: ['pending', 'invoice']
                    isInvoiceRelated: true
```

---

## Action Link Mapping

```
Detected Keyword          â†’    Action Link
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
'invoice'        
'billing'       
'payment'       â”€â”€â”€â”€â”€â†’   /invoices  (View All Invoices)
'bill'
'pending'


'gst'           â”€â”€â”€â”€â”€â†’   /reports/gst3-filing  (View GST Filing)
'tax'


(No match)      â”€â”€â”€â”€â”€â†’   null  (No action button)
```

---

## State Flow in Frontend

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Initial State                                      â”‚
â”‚  messages: []                                       â”‚
â”‚  input: ""                                          â”‚
â”‚  isLoading: false                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ User types and sends
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sending State                                      â”‚
â”‚  messages: [                                        â”‚
â”‚    { role: 'user',                                 â”‚
â”‚      content: 'Show me pending invoices',          â”‚
â”‚      timestamp: Date,                              â”‚
â”‚      actionLink: undefined }                        â”‚
â”‚  ]                                                  â”‚
â”‚  isLoading: true                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Wait for backend response
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Loading State                                      â”‚
â”‚  messages: [                                        â”‚
â”‚    { role: 'user', ... },                         â”‚
â”‚    { role: 'assistant',                           â”‚
â”‚      content: '',                                  â”‚
â”‚      timestamp: Date,                              â”‚
â”‚      actionLink: null }  â† Loading indicator       â”‚
â”‚  ]                                                  â”‚
â”‚  isLoading: true                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Response received
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Final State                                        â”‚
â”‚  messages: [                                        â”‚
â”‚    { role: 'user', ... },                         â”‚
â”‚    { role: 'assistant',                           â”‚
â”‚      content: 'You have 5 pending invoices...',   â”‚
â”‚      timestamp: Date,                              â”‚
â”‚      actionLink: {                                 â”‚
â”‚        label: 'View All Invoices',                â”‚
â”‚        path: '/invoices',                         â”‚
â”‚        icon: 'FileText'                           â”‚
â”‚      }}                                            â”‚
â”‚  ]                                                  â”‚
â”‚  isLoading: false                                   â”‚
â”‚                                                     â”‚
â”‚  ğŸ“„ View All Invoices â†’ (rendered)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ User clicks button
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ handleActionClick()          â”‚
        â”‚ 1. navigate('/invoices')      â”‚
        â”‚ 2. setIsOpen(false)           â”‚
        â”‚ 3. Chat closes               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
        User lands on Invoices page
        Aiva chat can be reopened anytime
```

---

## Message Rendering Tree

```
Message Component
    â”‚
    â”œâ”€â”€â”€ Is Assistant?
    â”‚    â”œâ”€ YES â†’ Show Aiva avatar (Sparkles icon)
    â”‚    â””â”€ NO  â†’ Show User avatar
    â”‚
    â”œâ”€â”€â”€ Display Message
    â”‚    â”œâ”€ Content text
    â”‚    â””â”€ Timestamp
    â”‚
    â””â”€â”€â”€ Is Invoice-Related?
         â”œâ”€ YES â†’ Render Action Button
         â”‚        â”œâ”€ Icon (based on icon prop)
         â”‚        â”œâ”€ Label text
         â”‚        â”œâ”€ Arrow icon
         â”‚        â””â”€ onClick handler
         â”‚
         â””â”€ NO  â†’ Skip button rendering
```

---

## API Response Evolution

### Before (v0)
```json
{
  "response": "You have 5 pending invoices..."
}
```

### After (v1) - Current Implementation
```json
{
  "response": "You have 5 pending invoices...",
  "isInvoiceRelated": true,
  "actionLink": {
    "label": "View All Invoices",
    "path": "/invoices",
    "icon": "FileText"
  }
}
```

### Future Potential (v2)
```json
{
  "response": "You have 5 pending invoices...",
  "isInvoiceRelated": true,
  "actionLinks": [
    {
      "label": "View All Invoices",
      "path": "/invoices",
      "icon": "FileText",
      "type": "primary"
    },
    {
      "label": "Create New Invoice",
      "path": "/create-invoice",
      "icon": "Plus",
      "type": "secondary"
    }
  ],
  "relatedTopics": ["receivables", "gst", "payables"]
}
```

---

## Component Interaction Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ Types & sends question
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aiva Component       â”‚
â”‚ - useState hooks     â”‚
â”‚ - handleSend()       â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ POST to Edge Function
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Edge Function               â”‚
â”‚ - detectInvoiceQuery()               â”‚
â”‚ - Call Mistral AI                    â”‚
â”‚ - generateActionLink()               â”‚
â”‚ - Return enhanced response           â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ Response with actionLink
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aiva Component                       â”‚
â”‚ - Update messages state              â”‚
â”‚ - Include actionLink in message      â”‚
â”‚ - Render component                   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ UI renders with button
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Interaction                     â”‚
â”‚ - Sees message with action button    â”‚
â”‚ - Clicks button                      â”‚
â”‚ - handleActionClick() triggered      â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€ navigate('/invoices')
      â”‚
      â””â”€ setIsOpen(false)
            â”‚
            â–¼
      Navigate to page & close chat
```

---

## Performance Breakdown

```
Total Response Time: ~150ms average

Breakdown:
â”œâ”€ Network latency to backend:           ~30ms
â”œâ”€ Invoice detection (detectInvoiceQuery): ~2ms
â”œâ”€ Mistral API call:                     ~80ms
â”œâ”€ Action link generation (generateActionLink): <1ms
â”œâ”€ Network latency back to frontend:     ~30ms
â””â”€ Frontend rendering:                   ~8ms
   â”œâ”€ Parse response:                    ~2ms
   â”œâ”€ Update state:                      ~2ms
   â”œâ”€ Re-render component:               ~4ms
   â””â”€ Display button:                    <1ms

Additional Features Impact: +5ms
(Keyword detection overhead)
```

---

## Feature Coverage Matrix

```
Question Type              | Detection | AI Answer | Action Link | Works
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€
Invoice listing            |    âœ“      |     âœ“     |      âœ“      |  âœ“
Payment status             |    âœ“      |     âœ“     |      âœ“      |  âœ“
GST calculation            |    âœ“      |     âœ“     |      âœ“      |  âœ“
Overdue invoices           |    âœ“      |     âœ“     |      âœ“      |  âœ“
Outstanding amount         |    âœ“      |     âœ“     |      âœ“      |  âœ“
Billing records            |    âœ“      |     âœ“     |      âœ“      |  âœ“
Invoice details            |    âœ“      |     âœ“     |      âœ“      |  âœ“
Profit & Loss              |    âœ—      |     âœ“     |      âœ—      |  âœ“
Cash flow                  |    âœ—      |     âœ“     |      âœ—      |  âœ“
Revenue analysis           |    âœ—      |     âœ“     |      âœ—      |  âœ“
```

---

**Diagram Version:** 1.0  
**Last Updated:** 2024  
**For Technical Reference Only**